<!doctype html>
<html>
  <head>
    <title>Demo</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:regular,bold,italic,thin,light,bolditalic,black,medium&lang=en">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link href="/bower_components/material-design-lite/material.min.css" rel="stylesheet">
    <script src="/bower_components/material-design-lite/material.min.js"></script>
    <script src="/tree3.js"></script>
  </head>
  <body>
    <h3>This is an example of a tree view</h3>
    <ul class="mdl-list">
    </ul>
  </body>

  <template id="li-row">
    <li class="mdl-list__item" style="flex-wrap: wrap;">
      <span class="mdl-list__item-primary-content">
        <button id="tree-menu-"
          class="mdl-button mdl-js-button mdl-button--icon mdl-list__item-avatar">
          <i class="material-icons">more_vert</i>
        </button>
        <ul class="mdl-menu mdl-js-menu mdl-js-ripple-effect"
          for="tree-menu-">
          <li id="add-subitem" class="mdl-menu__item mdl-menu__item--full-bleed-divider">
            <button class="mdl-button mdl-js-button mdl-button--icon">
              <i class="material-icons">add</i>
            </button>
            <span>Subitem</span>
          </li>
          <li class="mdl-menu__item">
            <button class="mdl-button mdl-js-button mdl-button--icon">
              <i class="material-icons">mode_edit</i>
            </button>
            Edit
          </li>
          <li class="mdl-menu__item mdl-menu__item--full-bleed-divider">
            <button class="mdl-button mdl-js-button mdl-button--icon">
              <i class="material-icons">details</i>
            </button>
            Details
          </li>
          <li class="mdl-menu__item">
            <button class="mdl-button mdl-js-button mdl-button--icon">
              <i class="material-icons">delete</i>
            </button>
            Delete
          </li>
        </ul>
        <span id="text">Item </span>
      </span>

      <button class="mdl-list__item-secondary-action mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">expand_more</i>
      </button>
    </li>
  </template>

  <template id="tree-subitem">
    <ul class="mdl-list" style="width: 100%;">
      <li class="mdl-list__item mdl-list__item--two-line">
        <span class="mdl-list__item-primary-content">
          <i class="material-icons mdl-list__item-avatar">person</i>
          <span>Bryan Cranston</span>
          <span class="mdl-list__item-sub-title">62 Episodes</span>
        </span>
        <span class="mdl-list__item-secondary-content">
          <span class="mdl-list__item-secondary-info">Actor</span>
          <a class="mdl-list__item-secondary-action" href="#"><i class="material-icons">star</i></a>
        </span>
      </li>
      <li class="mdl-list__item mdl-list__item--two-line">
        <span class="mdl-list__item-primary-content">
          <i class="material-icons mdl-list__item-avatar">person</i>
          <span>Aaron Paul</span>
          <span class="mdl-list__item-sub-title">62 Episodes</span>
        </span>
        <span class="mdl-list__item-secondary-content">
          <a class="mdl-list__item-secondary-action" href="#"><i class="material-icons">star</i></a>
        </span>
      </li>
      <li class="mdl-list__item mdl-list__item--two-line">
        <span class="mdl-list__item-primary-content">
          <i class="material-icons mdl-list__item-avatar">person</i>
          <span>Bob Odenkirk</span>
          <span class="mdl-list__item-sub-title">62 Episodes</span>
        </span>
        <span class="mdl-list__item-secondary-content">
          <a class="mdl-list__item-secondary-action" href="#"><i class="material-icons">star</i></a>
        </span>
      </li>
    </ul>
  </template>

  <script>
    'use strict';
    var tmpl = document.querySelector('template#li-row');
    var ul = document.querySelector('ul');
    for (var i = 0; i < 6; i++) {
      addRow('mdl-menu--bottom-left');
    }
    addRow('mdl-menu--top-left');
    i++;
    addRow('mdl-menu--top-left');
    i++;
    addRow('mdl-menu--top-left');

    function addRow(direction) {
      var clone = document.importNode(tmpl.content, true);
      clone.querySelector('#text').textContent += i + 1;
      clone.querySelector('#tree-menu-').id += i + 1;
      var threedots = clone.querySelector('[for="tree-menu-"]');
      threedots.setAttribute('for', `tree-menu-${i + 1}`);
      threedots.classList.add(direction);
      threedots.querySelector('li#add-subitem > span').textContent += i + 1;
      threedots.querySelector('li#add-subitem').addEventListener('click', e => {

        function search(parentNode, condition) {
          if (parentNode == null) {
            return null;
          }
          var tagName = condition.match(/< (.+):not.+/)[1].toUpperCase();
          var id = condition.match(/:not\(#(.+)\)/)[1];
          if (parentNode.tagName === tagName) {
            if (parentNode.id !== id) {
              return parentNode;
            }
          }
          return search(parentNode.parentNode, condition);
        }

        var li = search(e.target, '< li:not(#add-subitem)');
        var ul = document.importNode(document.querySelector('#tree-subitem').content, true);
        li.appendChild(ul);
      });
      ul.appendChild(clone);
    }
  </script>
</html>
